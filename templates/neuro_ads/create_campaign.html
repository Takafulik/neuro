{% extends 'base.html' %}
{% load static %}

{% block title %}Create AI Campaign - Neuro-Ads{% endblock %}

{% block extra_head %}
<style>
    .form-section {
        background: #f8f9fc;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        border-left: 4px solid #4e73df;
    }
    
    .platform-card {
        border: 2px solid #e3e6f0;
        border-radius: 10px;
        padding: 1rem;
        margin-bottom: 1rem;
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .platform-card:hover {
        border-color: #4e73df;
    }
    
    .platform-card.selected {
        border-color: #4e73df;
        background: #f8f9fc;
    }
    
    .platform-card.disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    .ai-badge {
        background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 15px;
        font-size: 0.7rem;
        font-weight: bold;
    }
    
    .step-indicator {
        display: flex;
        justify-content: space-between;
        margin-bottom: 2rem;
    }
    
    .step {
        flex: 1;
        text-align: center;
        position: relative;
    }
    
    .step::after {
        content: '';
        position: absolute;
        top: 15px;
        right: -50%;
        width: 100%;
        height: 2px;
        background: #e3e6f0;
        z-index: -1;
    }
    
    .step:last-child::after {
        display: none;
    }
    
    .step.active .step-number {
        background: #4e73df;
        color: white;
    }
    
    .step.completed .step-number {
        background: #1cc88a;
        color: white;
    }
    
    .step-number {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: #e3e6f0;
        color: #858796;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        margin-bottom: 0.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="h3 mb-0 text-gray-800">
                <i class="fas fa-robot text-primary mr-2"></i>
                Create AI-Powered Campaign
                <span class="ai-badge ml-2">AI POWERED</span>
            </h1>
            <p class="text-muted">Let AI generate and optimize your autonomous advertising campaign</p>
        </div>
    </div>

    <!-- Step Indicator -->
    <div class="step-indicator">
        <div class="step active">
            <div class="step-number">1</div>
            <div>Business Info</div>
        </div>
        <div class="step">
            <div class="step-number">2</div>
            <div>Campaign Goals</div>
        </div>
        <div class="step">
            <div class="step-number">3</div>
            <div>AI Generation</div>
        </div>
    </div>

    <form method="post" id="campaignForm">
        {% csrf_token %}
        
        <!-- Business Information -->
        <div class="form-section">
            <h5 class="mb-3">
                <i class="fas fa-building text-primary mr-2"></i>
                Business Information
            </h5>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="business_description">Business Description *</label>
                        <textarea class="form-control" id="business_description" name="business_description" 
                                rows="3" placeholder="Describe your business, products, or services..." required></textarea>
                        <small class="form-text text-muted">AI will use this to understand your business and generate relevant campaigns</small>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="product_service">Product/Service Name *</label>
                        <input type="text" class="form-control" id="product_service" name="product_service" 
                               placeholder="e.g., Marketing Software, Consulting Services" required>
                    </div>
                    <div class="form-group">
                        <label for="website_url">Website URL</label>
                        <input type="url" class="form-control" id="website_url" name="website_url" 
                               placeholder="https://yourwebsite.com">
                    </div>
                </div>
            </div>
        </div>

        <!-- Target Audience -->
        <div class="form-section">
            <h5 class="mb-3">
                <i class="fas fa-users text-primary mr-2"></i>
                Target Audience
            </h5>
            <div class="row">
                <div class="col-md-8">
                    <div class="form-group">
                        <label for="target_audience">Target Audience Description *</label>
                        <textarea class="form-control" id="target_audience" name="target_audience" 
                                rows="3" placeholder="Describe your ideal customers (age, interests, behaviors, demographics)..." required></textarea>
                        <small class="form-text text-muted">AI will analyze this to create optimal targeting across platforms</small>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-left-info">
                        <div class="card-body">
                            <h6 class="text-info">ðŸ’¡ AI Tip</h6>
                            <small class="text-muted">
                                Be specific about demographics, interests, and behaviors. 
                                The more detail, the better AI can optimize targeting.
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Campaign Goals & Budget -->
        <div class="form-section">
            <h5 class="mb-3">
                <i class="fas fa-bullseye text-primary mr-2"></i>
                Campaign Goals & Budget
            </h5>
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="campaign_goal">Primary Goal *</label>
                        <select class="form-control" id="campaign_goal" name="campaign_goal" required>
                            <option value="">Select Goal...</option>
                            {% for value, label in campaign_types %}
                            <option value="{{ value }}">{{ label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="total_budget">Total Budget ($) *</label>
                        <input type="number" class="form-control" id="total_budget" name="total_budget" 
                               min="100" step="50" placeholder="1000" required>
                        <small class="form-text text-muted">AI will distribute across platforms optimally</small>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="duration_days">Campaign Duration (days)</label>
                        <input type="number" class="form-control" id="duration_days" name="duration_days" 
                               min="7" max="90" value="30">
                    </div>
                </div>
            </div>
        </div>

        <!-- Platform Selection -->
        <div class="form-section">
            <h5 class="mb-3">
                <i class="fas fa-network-wired text-primary mr-2"></i>
                Advertising Platforms
            </h5>
            <p class="text-muted mb-3">Select platforms for your AI campaign. AI will optimize budget allocation automatically.</p>
            
            <div class="row">
                {% for platform in platforms %}
                <div class="col-md-4">
                    <div class="platform-card {% if platform.name not in connected_platforms %}disabled{% endif %}" 
                         onclick="togglePlatform('{{ platform.name }}', {{ platform.name in connected_platforms|yesno:'true,false' }})">
                        <div class="d-flex align-items-center">
                            <div class="mr-3">
                                {% if platform.name == 'google' %}
                                    <i class="fab fa-google fa-2x text-danger"></i>
                                {% elif platform.name == 'meta' %}
                                    <i class="fab fa-facebook fa-2x text-primary"></i>
                                {% elif platform.name == 'linkedin' %}
                                    <i class="fab fa-linkedin fa-2x text-info"></i>
                                {% endif %}
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1">{{ platform.get_name_display }}</h6>
                                <small class="text-muted">
                                    {% if platform.name == 'google' %}
                                        Search & Display Ads
                                    {% elif platform.name == 'meta' %}
                                        Facebook & Instagram Ads
                                    {% elif platform.name == 'linkedin' %}
                                        Professional B2B Targeting
                                    {% endif %}
                                </small>
                                {% if platform.name not in connected_platforms %}
                                <div class="text-warning small mt-1">
                                    <i class="fas fa-exclamation-triangle mr-1"></i>Not Connected
                                </div>
                                {% endif %}
                            </div>
                            <div>
                                <input type="checkbox" name="platforms" value="{{ platform.name }}" 
                                       {% if platform.name in connected_platforms %}class="platform-checkbox"{% else %}disabled{% endif %}>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            {% if connected_platforms|length == 0 %}
            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle mr-2"></i>
                No advertising platforms connected. 
                <a href="{% url 'neuro_ads:platform_connections' %}" class="alert-link">Connect platforms</a> 
                to enable AI campaign creation.
            </div>
            {% endif %}
        </div>

        <!-- AI Features Preview -->
        <div class="form-section">
            <h5 class="mb-3">
                <i class="fas fa-brain text-primary mr-2"></i>
                AI Features Included
            </h5>
            <div class="row">
                <div class="col-md-4">
                    <div class="text-center">
                        <i class="fas fa-magic fa-3x text-success mb-2"></i>
                        <h6>Auto Campaign Generation</h6>
                        <small class="text-muted">AI creates optimized campaigns, targeting, and ad copy</small>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="text-center">
                        <i class="fas fa-chart-line fa-3x text-info mb-2"></i>
                        <h6>Budget Optimization</h6>
                        <small class="text-muted">Real-time budget reallocation based on performance</small>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="text-center">
                        <i class="fas fa-vials fa-3x text-warning mb-2"></i>
                        <h6>A/B Testing</h6>
                        <small class="text-muted">Automatic testing of ad variations with statistical analysis</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Submit Button -->
        <div class="text-center">
            <button type="submit" class="btn btn-primary btn-lg" id="submitBtn" 
                    {% if connected_platforms|length == 0 %}disabled{% endif %}>
                <i class="fas fa-robot mr-2"></i>
                Generate AI Campaign
            </button>
            <div class="mt-2">
                <small class="text-muted">AI will analyze your inputs and create an optimized campaign strategy</small>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
function togglePlatform(platformName, isConnected) {
    if (!isConnected) {
        return; // Don't allow selection if not connected
    }
    
    const card = event.currentTarget;
    const checkbox = card.querySelector('input[type="checkbox"]');
    
    card.classList.toggle('selected');
    checkbox.checked = !checkbox.checked;
    
    updateSubmitButton();
}

function updateSubmitButton() {
    const checkedPlatforms = document.querySelectorAll('input[name="platforms"]:checked').length;
    const submitBtn = document.getElementById('submitBtn');
    
    if (checkedPlatforms > 0) {
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-robot mr-2"></i>Generate AI Campaign';
    } else {
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-robot mr-2"></i>Select Platform(s) First';
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // Initialize form validation
    const form = document.getElementById('campaignForm');
    
    form.addEventListener('submit', function(e) {
        const checkedPlatforms = document.querySelectorAll('input[name="platforms"]:checked').length;
        
        if (checkedPlatforms === 0) {
            e.preventDefault();
            alert('Please select at least one advertising platform.');
            return false;
        }
        
        // Show loading state
        const submitBtn = document.getElementById('submitBtn');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>AI is generating your campaign...';
    });
    
    // Real-time budget estimation
    const budgetInput = document.getElementById('total_budget');
    budgetInput.addEventListener('input', function() {
        const budget = parseFloat(this.value) || 0;
        const platforms = document.querySelectorAll('input[name="platforms"]:checked').length || 1;
        const perPlatform = budget / platforms;
        
        // Could show estimated per-platform budget here
    });
    
    updateSubmitButton();
});
</script>
{% endblock %}